---
layout: post
status: publish
published: true
title: 'PHP: работа с разными cms'

date: '2012-07-14 16:38:00 +0300'

categories:
- utils
tags:
- php
- bash
- cms
---
<div dir="ltr" style="text-align: left;" trbidi="on">
Несколько универсальных приемов для работы с "зоопарком" CMS:</p>
<p>1. Научитесь пользоваться grep/find/awk -- реально полезные инструменты для поиска кода. Допустим вы не знаете архитектуры/системы шаблонизации в конкретной системе и нужно внести&nbsp; какие либо правки. Можно конечно пойти почитать доки(если они есть :) ), начать "разварачивать код" с входной точки (index.php или другой), но для мелких правок проще всего зайти по ssh и запустить:</p>
<p>on@on$ find ./www/ | grep -e ".(html|php|tpl)" | grep 'ФРАЗА' `xargs`</p>
<p>В результате будет выведен список файлов в которых есть слово ФРАЗА. Обьясню эти команды последовательно:</p>
<ul style="text-align: left;">
<li>символ "|" означает пайп (pipe) -- т.е. результат выполнения комады до "|" будет передан программе после пайпа на stdin.&nbsp;</li>
<li>получаеться что "find ./www" -- выдает список файлов в папке хоста,&nbsp;</li>
<li>на вход "grep -e ".(html|php|tpl)" передаеться этот список, и команда фильтрует файлы по расширению</li>
<li>команда "grep 'ФРАЗА' `xargs`" ищет фразу в файлах. Для того чтобы передать имя файла (из списка) используем программа xargs заключенную в обратные кавычки (важно!)</li>
</ul>
<p>&nbsp; В сети есть и более интересные случаи применения grep/awk </p>
<p>
2. Используйте sed -- еще одна программа из набора "must have". Допустим вам нужно сменить пароли для БД, или поменять пути при переносе сайта на другой хостинг. Естественно "поменять вручную" строки в файлах займет кучу времени, и принесет один гемор..<br />
Для замены "СЛОВО1" на "СЛОВО2" во всех файлах директории, можно просто запустить команду:</p>
<p>on@on$ find ./www/ | sed -i 's/СЛОВО1/СЛОВО2/' </p>
<p>Используйте с осторожностью, а лучше всего делайте бекапы перед заменами, т.к. практика показывает что неумелое использование sed приводит к потерям кода/а далее соответсвенно и к времени на восстановление.</p>
<p>3. Используйте систему контроля версий (VCS). -- даже если ваше начальство/сотрудники этого не требуют, это гораздо облегчит вашу работу с конкретным проектом ( даже если над ним работает 1 человек).</p>
<p>4. Делайте бекапы каждый день. -- если у вас нет админа, лучше всего заняться этим самому, т.е. написать пару скриптов для бекапов. Т.е. если вы пользуетесь VCS вам нужно делать бекапы БД уже работаюшего сайта. Повреждение/замену файлов можно будет найти сравнив их с локальными файлами (файлами в репозитории)</p>
<p>
Все эти ф-ции есть в большинстве популярных IDE (NetBeans/NuSphere PHPed/Eclipse/PHP Storm), но иногда всетауи удобней сделать все из консоли.</p>
</div>
